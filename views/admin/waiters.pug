extends base

block content

  // Page Header
  section.page-header
    .container
      h1 ğŸ“‹ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
      p Ø§Ø®ØªØ± Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ ÙˆØ­Ø¯Ø¯ Ø§Ù„ÙƒÙ…ÙŠØ©

  // Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ²Ø©
  section.table-number-section
    .container
      .table-number-box
        .form-row
          .form-group
            label(for="tableNumber") Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ²Ø©
            input#tableNumber(type="text" placeholder="Ù…Ø«Ø§Ù„: 5" required)

        .form-row
          .form-group
            label(for="customerNotes") Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            textarea#customerNotes(rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©")

  // Products Section - Waiter Style
  section.waiter-products-section
    .container
      h2.offers-title    Ø§Ù„Ù…Ù†ÙŠÙˆ
      .waiter-grid#waiterGrid
        each meal in meals
          .waiter-item(data-category=meal.category)
            .waiter-item-content
              h3.waiter-item-name= meal.name
              .waiter-item-controls
                button.waiter-qty-btn(
                  type="button"
                  onclick=`decreaseWaiterQty(this)`
                ) âˆ’
                input.waiter-qty-input(
                  type="number"
                  value="0"
                  min="0"
                  max="99"
                  readonly
                  data-name=meal.name
                  data-price=meal.price
                  data-image=meal.image
                )
                button.waiter-qty-btn(
                  type="button"
                  onclick=`increaseWaiterQty(this)`
                ) +

  // Ø§Ù„Ø¹Ø±ÙˆØ¶
  section.waiter-offers-section
    .container
      h2.offers-title ğŸ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©
      .waiter-grid#waiterOffersGrid
        .waiter-item.waiter-offer
          .waiter-item-content
            h3.waiter-item-name Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ¨Ø¯Ø© Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±Ø§Ù†ÙŠ (2 ÙƒÙŠÙ„Ùˆ)
            .waiter-item-controls
              button.waiter-qty-btn(
                type="button"
                onclick=`decreaseWaiterQty(this)`
              ) âˆ’
              input.waiter-qty-input(
                type="number"
                value="0"
                min="0"
                max="99"
                readonly
                data-name="Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ¨Ø¯Ø© Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±Ø§Ù†ÙŠ"
                data-price="450"
                data-image="/images/offer1.jpg"
              )
              button.waiter-qty-btn(
                type="button"
                onclick=`increaseWaiterQty(this)`
              ) +

        .waiter-item.waiter-offer
          .waiter-item-content
            h3.waiter-item-name Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© (ÙƒØ¨Ø¯Ø© + Ù…Ù…Ø¨Ø§Ø± + Ø³Ø¬Ù‚)
            .waiter-item-controls
              button.waiter-qty-btn(
                type="button"
                onclick=`decreaseWaiterQty(this)`
              ) âˆ’
              input.waiter-qty-input(
                type="number"
                value="0"
                min="0"
                max="99"
                readonly
                data-name="Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©"
                data-price="600"
                data-image="/images/offer2.jpg"
              )
              button.waiter-qty-btn(
                type="button"
                onclick=`increaseWaiterQty(this)`
              ) +

  // Order Summary
  section.waiter-summary-section
    .container
      .waiter-summary
        h3 ğŸ“ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
        #waiterOrderItems.waiter-order-items
          p.empty-order Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯
        .waiter-total
          span Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:
          span#waiterTotal 0 Ø¬Ù†ÙŠÙ‡
        button#submitOrderBtn.btn.btn-primary.btn-submit-order(
          type="button"
          onclick="submitWaiterOrder()"
        ) Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ“

  // Success Modal
  #waiterSuccessModal.modal
    .modal-content
      .modal-icon.success âœ“
      h2 ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!
      p Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <span id="modalOrderNumber"></span>
      p Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ²Ø©: <span id="modalTableNumber"></span>
      p Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="modalTotal"></span> Ø¬Ù†ÙŠÙ‡
      button.btn.btn-primary(onclick="closeWaiterModal()") Ø­Ø³Ù†Ø§Ù‹

  // Scripts
  script.
    // Toast Notification Function
    function showToast(type, title, message) {
      const existingToast = document.querySelector('.toast');
      if (existingToast) existingToast.remove();

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      const icons = { warning: 'âš ï¸', error: 'âŒ', success: 'âœ…' };

      toast.innerHTML = `
        <div class="toast-icon">${icons[type] || 'ğŸ“‹'}</div>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <p class="toast-message">${message}</p>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
      `;

      document.body.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 10);
      setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 4000);
    }

    // Increase quantity
    function increaseWaiterQty(btn) {
      const input = btn.previousElementSibling;
      const currentVal = parseInt(input.value) || 0;
      if (currentVal < 99) {
        input.value = currentVal + 1;
        updateWaiterSummary();
      }
    }

    // Decrease quantity
    function decreaseWaiterQty(btn) {
      const input = btn.nextElementSibling;
      const currentVal = parseInt(input.value) || 0;
      if (currentVal > 0) {
        input.value = currentVal - 1;
        updateWaiterSummary();
      }
    }

    // Update order summary
    function updateWaiterSummary() {
      const orderItemsDiv = document.getElementById('waiterOrderItems');
      const totalSpan = document.getElementById('waiterTotal');

      const allInputs = document.querySelectorAll('.waiter-qty-input');
      let orderHTML = '';
      let total = 0;
      let hasItems = false;

      allInputs.forEach(input => {
        const qty = parseInt(input.value) || 0;
        if (qty > 0) {
          hasItems = true;
          const name = input.dataset.name;
          const price = parseFloat(input.dataset.price);
          const itemTotal = qty * price;
          total += itemTotal;

          orderHTML += `
            <div class="waiter-order-row">
              <span class="order-item-name">${name}</span>
              <span class="order-item-qty">Ã—${qty}</span>
              <span class="order-item-price">${itemTotal} Ø¬</span>
            </div>
          `;
        }
      });

      orderItemsDiv.innerHTML = hasItems ? orderHTML : '<p class="empty-order">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>';
      totalSpan.textContent = `${total} Ø¬Ù†ÙŠÙ‡`;
    }

    // Submit order
    async function submitWaiterOrder() {
      const tableNumber = document.getElementById('tableNumber').value.trim();
      const customerNotes = document.getElementById('customerNotes').value.trim();

      if (!tableNumber) {
        showToast('warning', 'Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ²Ø© Ù…Ø·Ù„ÙˆØ¨', 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø§Ø¨ÙŠØ²Ø© Ø£ÙˆÙ„Ø§Ù‹');
        document.getElementById('tableNumber').focus();
        return;
      }

      const allInputs = document.querySelectorAll('.waiter-qty-input');
      const cart = [];
      let total = 0;

      allInputs.forEach(input => {
        const qty = parseInt(input.value) || 0;
        if (qty > 0) {
          cart.push({
            name: input.dataset.name,
            price: parseFloat(input.dataset.price),
            quantity: qty,
            image: input.dataset.image
          });
          total += qty * parseFloat(input.dataset.price);
        }
      });

      if (cart.length === 0) {
        showToast('warning', 'Ø§Ù„Ø·Ù„Ø¨ ÙØ§Ø±Øº', 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø·Ø¨Ù‚ ÙˆØ§Ø­Ø¯');
        return;
      }

      const orderData = { address: tableNumber, cart, total };
      if (customerNotes) orderData.notes = customerNotes;

      try {
        const response = await fetch('/api/v1/order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData)
        });
        const data = await response.json();

        if (data.status === 'success') {
          document.getElementById('modalOrderNumber').textContent = data.data.numberOrder || 'Ø¬Ø¯ÙŠØ¯';
          document.getElementById('modalTableNumber').textContent = tableNumber;
          document.getElementById('modalTotal').textContent = total;
          document.getElementById('waiterSuccessModal').classList.add('show');
          setTimeout(resetWaiterForm, 2000);
        } else {
          showToast('error', 'ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
      }
    }

    // Close modal
    function closeWaiterModal() {
      document.getElementById('waiterSuccessModal').classList.remove('show');
    }

    // Reset form
    function resetWaiterForm() {
      document.getElementById('tableNumber').value = '';
      document.getElementById('customerNotes').value = '';
      document.querySelectorAll('.waiter-qty-input').forEach(input => input.value = '0');
      updateWaiterSummary();
    }

    // Click outside modal to close
    document.addEventListener('click', (e) => {
      const modal = document.getElementById('waiterSuccessModal');
      if (e.target === modal) closeWaiterModal();
    });
