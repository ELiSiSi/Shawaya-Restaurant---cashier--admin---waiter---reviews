extends base

block content
  .allBills
    if orders && orders.length > 0
      each order in orders
        .invoice
          .invoice-header
            h2 Ù…Ø·Ø¹Ù… Ø´ÙˆÙŠØ©
            p.invoice-number Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: #{order.numberOrder || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}

          .invoice-section
            h3 ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
            if order.name && order.name !== ''
              .invoice-row
                span.label Ø§Ù„Ø§Ø³Ù…:
                span.value #{order.name}
              .invoice-row
                span.label Ø§Ù„Ù‡Ø§ØªÙ:
                span.value #{order.number || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
              .invoice-row
                span.label Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:
                span.value #{order.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
              if order.notes && order.notes !== ""
                .invoice-row
                  span.label Ù…Ù„Ø­ÙˆØ¸Ø©:
                  span.value #{order.notes}
            else
              .invoice-row
                span.label Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ù‡:
                span.value #{order.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
              if order.notes && order.notes !== ""
                .invoice-row
                  span.label Ù…Ù„Ø­ÙˆØ¸Ø©:
                  span.value #{order.notes}

          .invoice-section
            h3 ğŸ›’ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
            table.invoice-table
              thead
                tr
                  th Ø§Ù„Ù…Ù†ØªØ¬
                  th Ø§Ù„ÙƒÙ…ÙŠØ©
                  th Ø§Ù„Ø³Ø¹Ø±
                  th Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
              tbody
                if order.cart && order.cart.length > 0
                  each item in order.cart
                    tr
                      td #{item.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                      td #{item.quantity || 1}
                      td #{(item.price || 0).toFixed(2)} Ø¬Ù†ÙŠÙ‡
                      td #{((item.quantity || 1) * (item.price || 0)).toFixed(2)} Ø¬Ù†ÙŠÙ‡
                else
                  tr
                    td(colspan="4", style="text-align:center; color:#999;")
                      | Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø·Ù„Ø¨

          .invoice-footer
            .invoice-total
              span.total-label ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:
              span.total-value #{order.total || 0} Ø¬Ù†ÙŠÙ‡
            .invoice-status
              span.label Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:
              span.status-badge(class=order.status || 'pending')
                | #{order.status || 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}

          .invoice-actions
            button.action-btn.done(type="button" data-id=order._id)
              i.fa.fa-check
              | ØªÙ…
            button.action-btn.cancel(type="button" data-id=order._id)
              i.fa.fa-times
              | Ø¥Ù„ØºØ§Ø¡
    else
      p(style="text-align:center; color:#999; margin-top:20px;")
        | Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§


  script.
    document.addEventListener('click', async (e) => {
      const btn = e.target.closest('.action-btn');
      if (!btn) return;

      const orderId = btn.dataset.id;
      let status = 'pending';

      if (btn.classList.contains('done')) status = 'done';
      if (btn.classList.contains('cancel')) status = 'cancel';

      try {
        const res = await fetch(`/api/v1/order/${orderId}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status })
        });

        if (res.ok) {
          location.reload();
        } else {
          alert('Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©');
        }
      } catch (err) {
        alert('Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
      }
    });
